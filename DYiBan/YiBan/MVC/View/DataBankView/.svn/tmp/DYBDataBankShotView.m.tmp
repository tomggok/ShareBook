//
//  DYBDataBankShotView.m
//  DYiBan
//
//  Created by tom zeng on 13-8-19.
//  Copyright (c) 2013年 ZzL. All rights reserved.
//

#import "DYBDataBankShotView.h"
#import <Accelerate/Accelerate.h>
#import "DYBInputView.h"
#import "DYBScroller.h"
#import "scrollerData.h"
@implementation DYBDataBankShotView{

    UIView *bgView;
    DYBInputView*  _nameInput;
    id receive;

}

DEF_SIGNAL(LEFT)
DEF_SIGNAL(RIGHT)
DEF_SIGNAL(INPUTWORD)
DEF_SIGNAL(SINGLEBTN)

@synthesize type = _type , rowNum = _rowNum ,labelText = _labelText,strMsg = _strMsg,strTitlt = _strTitlt;
- (id)initWithFrame:(CGRect)frame type:(NSUInteger)_nType 
{
    self = [super initWithFrame:frame];
    if (self) {
        // Initialization code_type

        self.type = [NSString stringWithFormat:@"%d",_nType];
        
        [self initView:_nType];
       
    }
    return self;
}

- (id)initWithFrame:(CGRect)frame type:(NSUInteger)_nType title:(NSString *)title MSG:(NSString *)MSG{
    
    self.strTitlt = title;
    self.strMsg = MSG;

   self =  [self initWithFrame:frame type:_nType];
    return self;

}
-(void)initView:(NSUInteger)type{
    
    UIView *graybBG = [[UIView alloc]initWithFrame:self.bounds];
    [graybBG setBackgroundColor:[UIColor grayColor]];
    [graybBG setAlpha:0.6];
    [self addSubview:graybBG];
    RELEASE(graybBG);
        
    switch (type) {  // btn 区分 点击
            
        case BTNTAG_SINGLE:
        {
            [self creatBGview];
            
            int offset = 40.0f;
            
            if (_strTitlt.length != 0) {
                
                CGSize strSize = [_strTitlt sizeWithFont:[UIFont systemFontOfSize:16] constrainedToSize:CGSizeMake(MAXFLOAT, 40)];
                UILabel *labelTitle = [[UILabel alloc]initWithFrame:CGRectMake(10.0f, 25.0f , strSize.width, 40.0f)];
                [labelTitle setFont:[UIFont systemFontOfSize:16]];
                [labelTitle setText:_strTitlt];
                [labelTitle setCenter:CGPointMake(bgView.frame.size.width/2 , 25)];
                [labelTitle setBackgroundColor:[UIColor clearColor]];
                [bgView addSubview:labelTitle];
                RELEASE(labelTitle);
            }
            
            if (_strMsg.length != 0) {
                
                
                CGSize strSizeText = [_strMsg sizeWithFont:[UIFont systemFontOfSize:16] constrainedToSize:CGSizeMake(MAXFLOAT, 40)];
                _labelText = [[UILabel alloc]initWithFrame:CGRectMake(10.0f, 40.0f + offset, strSizeText.width, 40.0f)];
                [_labelText setText:_strMsg];
                [_labelText setFont:[UIFont systemFontOfSize:16]];
                [_labelText setCenter:CGPointMake(bgView.frame.size.width/2, 90/2)];
                [_labelText setBackgroundColor:[UIColor clearColor]];
                [bgView addSubview:_labelText];
                RELEASE(_labelText);
            }
            
            [self creatSingleBtn];
            
        }
            break;
        case BTNTAG_CHANGE:{
            
                    
        }
            break;
        case BTNTAG_RENAME:
        {
            
            [self creatBGview];
            
            _nameInput = [[DYBInputView alloc]initWithFrame:CGRectMake(15.0f, 30.0f, 240.0f, 40.0f) placeText:@"XXXX" textType:0];
            [_nameInput setBackgroundColor:[UIColor whiteColor]];
            [_nameInput.nameField setText:_strMsg];
            [bgView addSubview:_nameInput];
            RELEASE(_nameInput);
            
            
            [self creatoOperationBTN];
        }
            break;
        case BTNTAG_DOWNLOAD:
            
            break;
        case BTNTAG_DEL:
        {
            
            [self creatBGview];
            
            int offset = 40.0f;
            
            if (_strTitlt.length != 0) {
                
                CGSize strSize = [_strTitlt sizeWithFont:[UIFont systemFontOfSize:16] constrainedToSize:CGSizeMake(MAXFLOAT, 40)];
                UILabel *labelTitle = [[UILabel alloc]initWithFrame:CGRectMake(10.0f, 25.0f , strSize.width, 40.0f)];
                [labelTitle setFont:[UIFont systemFontOfSize:16]];
                [labelTitle setText:_strTitlt];
                [labelTitle setCenter:CGPointMake(bgView.frame.size.width/2 , 25)];
                [labelTitle setBackgroundColor:[UIColor clearColor]];
                [bgView addSubview:labelTitle];
                RELEASE(labelTitle);
            }
            
            if (_strMsg.length != 0) {
                
            
                CGSize strSizeText = [_strMsg sizeWithFont:[UIFont systemFontOfSize:16] constrainedToSize:CGSizeMake(MAXFLOAT, 40)];
                _labelText = [[UILabel alloc]initWithFrame:CGRectMake(10.0f, 40.0f + offset, strSizeText.width, 40.0f)];
                [_labelText setText:_strMsg];
                [_labelText setFont:[UIFont systemFontOfSize:16]];
                [_labelText setCenter:CGPointMake(bgView.frame.size.width/2, 90/2)];
                [_labelText setBackgroundColor:[UIColor clearColor]];
                [bgView addSubview:_labelText];
                RELEASE(_labelText);
            }
            
            [self creatoOperationBTN];
        
        }
            
            break;
            
        default:
            break;
    }

    
}
-(void)creatSingleBtn{

    DragonUIButton *rightBtn = [[DragonUIButton alloc]initWithFrame:CGRectMake(0,  150-50, 540/2, 100/2)];
    [rightBtn setBackgroundColor:[UIColor clearColor]];
    [rightBtn setImage:[UIImage imageNamed:@"alert_onlyyes_def"] forState:UIControlStateNormal];
    [rightBtn setImage:[UIImage imageNamed:@"alert_onlyyes_hlt"] forState:UIControlStateHighlighted];
    [rightBtn  addSignal:[DYBDataBankShotView RIGHT] forControlEvents:UIControlEventTouchUpInside];
    [bgView addSubview:rightBtn];
    [rightBtn release];



}
-(void)creatBGview{

    bgView = [[UIView alloc]initWithFrame:CGRectMake(0.0f, 0.0f, 540/2, 300/2)];
    [bgView setBackgroundColor:[UIColor colorWithRed:248/255.0f green:248/255.0f blue:248/255.0f alpha:1.0f]];
    
    bgView.layer.masksToBounds = YES;
    bgView.layer.cornerRadius = 6.0;
    bgView.layer.borderWidth = 1.0;
    bgView.layer.borderColor = [[UIColor clearColor] CGColor];
    [[bgView layer] setShadowRadius:10];
    [[bgView layer] setShadowOpacity:10];
    bgView.layer.shadowColor=[UIColor redColor].CGColor;
    bgView.layer.shadowOffset=CGSizeMake(20, 20);
    
    //阴影
//    bgView.layer.shadowPath =[UIBezierPath bezierPathWithRect:bgView.bounds].CGPath;
//    [[bgView layer] setShadowOffset:CGSizeMake(5, 5)];
//    [[bgView layer] setShadowRadius:10];
//    [[bgView layer] setShadowOpacity:10];
//    [[bgView layer] setShadowColor:[UIColor blackColor].CGColor];

    
    
    [bgView setCenter: CGPointMake(160, APPDELEGATE.window.center.y)];
    [self addSubview:bgView];
    [bgView release];



}

-(void)creatoOperationBTN{

    DragonUIButton *btnLeft = [[DragonUIButton alloc]initWithFrame:CGRectMake(0.0f, 150-50, 270.0/2, 100/2)];
    [btnLeft setBackgroundColor:[UIColor clearColor]];
    [btnLeft  addSignal:[DYBDataBankShotView LEFT] forControlEvents:UIControlEventTouchUpInside];
    [btnLeft setImage:[UIImage imageNamed:@"alert_no_def"] forState:UIControlStateNormal];
    [btnLeft setImage:[UIImage imageNamed:@"alert_no_high"] forState:UIControlStateHighlighted];
    [bgView addSubview:btnLeft];
    [btnLeft release];
    
    
    DragonUIButton *rightBtn = [[DragonUIButton alloc]initWithFrame:CGRectMake(135,  150-50, 270.0/2, 100/2)];
    [rightBtn setBackgroundColor:[UIColor clearColor]];
    [rightBtn setImage:[UIImage imageNamed:@"alert_yes_def"] forState:UIControlStateNormal];
    [rightBtn setImage:[UIImage imageNamed:@"alert_yes_high"] forState:UIControlStateHighlighted];
    [rightBtn  addSignal:[DYBDataBankShotView RIGHT] forControlEvents:UIControlEventTouchUpInside];
    [bgView addSubview:rightBtn];
    [rightBtn release];
    



}
#pragma mark- 选择滑动框



-(void)setMessage:(NSString *)message{
    
    if (_labelText != nil) {
//        _labelText.text = message;
    }
    
}


-(void)setReceive:(id)obj{

    receive = obj;

}
-(void)handleViewSignal_DYBDataBankShotView:(DragonViewSignal *)signal{

    NSMutableDictionary *sendDcit = nil;
    

    
    sendDcit = [[NSMutableDictionary alloc]init];
    [sendDcit setValue:self.type forKey:@"type"];
    [sendDcit setValue:_rowNum forKey:@"rowNum"];
    [sendDcit setValue:_nameInput.nameField.text forKey:@"text"];
    
    if ([signal is:[DYBDataBankShotView LEFT]]) {
        
       
        [self sendViewSignal:[DYBDataBankShotView LEFT] withObject:sendDcit from:self target:receive];
         [self removeFromSuperview];
    
        
    }else if([signal is:[DYBDataBankShotView RIGHT]]){
    
        [self sendViewSignal:[DYBDataBankShotView RIGHT] withObject:sendDcit from:self target:receive];
        [self removeFromSuperview];
        
    }
    RELEASEDICTARRAYOBJ(sendDcit);

}

-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event{

//    [self removeFromSuperview];


}
- (void)handleViewSignal_DragonUITextField:(DragonViewSignal *)signal
{
    if ([signal.source isKindOfClass:[DragonUITextField class]])//完成编辑
    {
        
        [bgView setCenter:CGPointMake(160.0f, 140.0)]; //test 
        
    }
}
- (void)dealloc
{
//    RELEASE(receive);
    [super dealloc];
}
/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect
{
    // Drawing code
}
*/

@end
