//
//  DYBDataBankSelectBtn.m
//  DYiBan
//
//  Created by tom zeng on 13-9-2.
//  Copyright (c) 2013年 ZzL. All rights reserved.
//

#import "DYBDataBankSelectBtn.h"
#import "Dragon_UIButton.h"
#import "DYBDtaBankSearchView.h"


#define SYSTEMFOLDER  100
@implementation DYBDataBankSelectBtn{
    
    DragonUIButton *allBtn[5];
    DragonUIButton *goodBtn[4];
    
    BOOL _isSysFolder;

}

@synthesize showType = _showType,targetCell = _targetCell,sendMegTarget = _sendMegTarget;
@synthesize bFolder = _bFolder,touchCellIndexPath = _touchCellIndexPath;
@synthesize beginOrPause = _beginOrPause;


DEF_SIGNAL(TOUCHBTN)
DEF_SIGNAL(TOUCHSIGLEBTN)

- (void)dealloc
{
    RELEASEOBJ(_touchCellIndexPath);
    RELEASEOBJ(_targetCell);
    RELEASEOBJ(_sendMegTarget);
    [super dealloc];
}

- (void)setTouchCellIndexPath:(NSIndexPath *)touchCellIndexPath
{
    [_touchCellIndexPath release];
    _touchCellIndexPath = [touchCellIndexPath retain];
}

-(id)initTarget:(id)target index:(NSIndexPath *)index{
    
    self = [super init];
    if (self) {
        self.sendMegTarget = target;
        self.touchCellIndexPath = index;
        
    }
    return self;

}
-(UITableViewCell *)addBtnToCell:(UIView *)view type:(int)type{

    
     _showType = type;
    
    if (type == SYSTEMFOLDER) { //判断系统文件
        _isSysFolder = YES;
        _showType = 0;
    }else{
    
        _isSysFolder = NO;
    }
    self.targetCell = view;
   
    [self setupSideSwipeView];

    return _targetCell;

}
- (void)setupSideSwipeView
{
    
    
    switch (_showType) {
            
        case 0:
        {
            [self creatAllBtn];
            
        }
            break;
        case 1:
        {
           [self creatShareANDDELBtn];
                     
        }
            break;
        case 2:
        {
            [self creratShareBtn];
            
        }
            break;
        case 3:
        {
            [self creatGoodBtn];
            
        }
            break;
        case 4:
        {
            
            
             [self creatDELBtn];
             break;
        }
        case 5:
        {
            
            [self creatProgressBtn];
        }
            break;
            
        default:
            break;
    }
    
   
     
}
-(void)creatAllBtn{
    
    for (int i = 0; i < 5; i++) {
       
        
        
        
        allBtn[i] = [DragonUIButton buttonWithType:UIButtonTypeCustom];
        [allBtn[i] setTag:BTNTAG_SHARE + i];
        DragonUIButton *btn = allBtn[i];
        NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:allBtn[i],@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row", nil];
        
        id target = nil;
        if ([_sendMegTarget isKindOfClass:[DYBDtaBankSearchView class]]) {
            target = [DYBDtaBankSearchView class];
        }
        else{
            target = [DYBDataBankSelectBtn class];
        
        }
        [btn addSignal:[target TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
        
        [allBtn[i] setFrame:CGRectMake(45 + i*(CELL_BTN_WIDTH + 6), (84 - CELL_BTN_HIGHT)/2, CELL_BTN_WIDTH, CELL_BTN_HIGHT)];
        
        switch (i) {
            case 0:{
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_share_def"] forState:UIControlStateNormal];
                
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@""] forState:UIControlStateDisabled];
            }
                break;
            case 1:
            {
                
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_resave_def"] forState:UIControlStateNormal];
//                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_move_dis"] forState:UIControlStateDisabled];
//
//                [ allBtn[i] setEnabled:!_isSysFolder];
                
            }
                
                break;
            case 2:
            {
                
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_rename_def"] forState:UIControlStateNormal];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_rename_dis"] forState:UIControlStateDisabled];

                [allBtn[i] setEnabled:!_isSysFolder];
                
            }
                
                break;
            case 3:
            {
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_offline_def"] forState:UIControlStateNormal];
//                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_offline_dis"] forState:UIControlStateDisabled];
//                 [allBtn[i] setEnabled:!_bFolder];
            }
                
                break;
            case 4:
            {
                
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_clear_def.png"] forState:UIControlStateNormal];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_clear_def.png"] forState:UIControlStateDisabled];

                [allBtn[i] setEnabled:!_isSysFolder];
            }
                break;
                
            default:
                break;
        }
        
        [_targetCell addSubview: allBtn[i]];
    }
    
        
    
}

-(void)forbidTouch{
    
    for (int i = 1; i <= 4 ; i++) {
        [allBtn[i] setSelected:NO];
        //        [allBtn[i] sett];
    }
    
    
    
}

-(void)creratShareBtn{
    DragonUIButton *shareBtn = [DragonUIButton buttonWithType:UIButtonTypeCustom];
    [shareBtn setTag:BTNTAG_SHARE];
    [shareBtn setBackgroundImage:[UIImage imageNamed:@"file_share_def"] forState:UIControlStateNormal];
    
     NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:shareBtn,@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row", nil];

    [shareBtn addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
    [shareBtn setFrame:CGRectMake((320 - 45 - CELL_BTN_WIDTH)/2 + 45, 0.0f  , CELL_BTN_WIDTH, CELL_BTN_HIGHT)];
    [shareBtn setBackgroundImage:[UIImage imageNamed:@""] forState:UIControlStateDisabled];

    [_targetCell addSubview:shareBtn];
}

-(void)creatDELBtn{
    
    DragonUIButton *shareBtn = [DragonUIButton buttonWithType:UIButtonTypeCustom];
    [shareBtn setTag:BTNTAG_DEL];
    [shareBtn setBackgroundImage:[UIImage imageNamed:@"file_del_def"] forState:UIControlStateNormal];
    
    NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:shareBtn,@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row", nil];
    
    [shareBtn addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
    [shareBtn setBackgroundColor:[UIColor clearColor]];
    [shareBtn setFrame:CGRectMake((320 - 45 - CELL_BTN_WIDTH)/2 + 45, 0.0f  , CELL_BTN_WIDTH, CELL_BTN_HIGHT)];
    [shareBtn setBackgroundImage:[UIImage imageNamed:@""] forState:UIControlStateDisabled];

    [_targetCell addSubview:shareBtn];
    
}


-(void)creatShareANDDELBtn{
    
    DragonUIButton *shareBtn = [DragonUIButton buttonWithType:UIButtonTypeCustom];
    [shareBtn setTag:BTNTAG_SHARE];
    [shareBtn setBackgroundImage:[UIImage imageNamed:@"file_share_def"] forState:UIControlStateNormal];

    NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:shareBtn,@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row", nil];
    
    [shareBtn addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
    
    [shareBtn setFrame:CGRectMake(80, 0.0f, CELL_BTN_WIDTH, CELL_BTN_HIGHT)];
    [shareBtn setBackgroundImage:[UIImage imageNamed:@""] forState:UIControlStateDisabled];

    [_targetCell addSubview:shareBtn];
    
    
    DragonUIButton *delBtn = [DragonUIButton buttonWithType:UIButtonTypeCustom];
    [delBtn setTag:BTNTAG_CANCELSHARE];
    [delBtn setBackgroundImage:[UIImage imageNamed:@"取消"] forState:UIControlStateNormal];

    NSDictionary *dict1 = [[NSDictionary alloc]initWithObjectsAndKeys:delBtn,@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row", nil];
    
    [delBtn addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict1];
    
    [delBtn setFrame:CGRectMake((500 - CELL_BTN_WIDTH)/2, (84 - NEWCELL_BTN_WIDTH)/2 , NEWCELL_BTN_WIDTH, NEWCELL_BTN_WIDTH)];
    [delBtn setBackgroundImage:[UIImage imageNamed:@""] forState:UIControlStateDisabled];

    [_targetCell addSubview:delBtn];

    
    
}

//重新设置bt的object
- (void)resetBtRow
{
    for (int i = 0; i < 3; i++)
    {
        NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:allBtn[i],@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row",_targetCell,@"cell", nil];
        [allBtn[i] addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
    }
    
}

-(void)creatProgressBtn{
    
    for (int i = 0; i < 3; i++) {
        allBtn[i] = [DragonUIButton buttonWithType:UIButtonTypeCustom];
        NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:allBtn[i],@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row",_targetCell,@"cell", nil];
        
        
        [allBtn[i] addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
        
        [allBtn[i] setFrame:CGRectMake(70 + i*NEWCELL_BTN_HIGHT*2, (84 - NEWCELL_BTN_WIDTH)/2, NEWCELL_BTN_HIGHT, NEWCELL_BTN_HIGHT)];
        [allBtn[i] setTag:BTNTAG_SHARE + i];
        switch (i) {
            case 0:{
                if (!_beginOrPause)
                {
                    [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"暂停"] forState:UIControlStateNormal];
                    
                    [allBtn[i] setBackgroundImage:[UIImage imageNamed:@""] forState:UIControlStateDisabled];
                }else
                {
                    [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"删除"] forState:UIControlStateNormal];
                    
                    [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"删除"] forState:UIControlStateDisabled];
                    [allBtn[i] setTag:BTNTAG_RESTART];
                }

            }
                break;
            case 1:
            {
                
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"重传"] forState:UIControlStateNormal];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"重传"] forState:UIControlStateDisabled];
            
            }
                
                break;
            case 2:
            {
                
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"删除"] forState:UIControlStateNormal];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"删除"] forState:UIControlStateDisabled];
    
            }
                
                break;
            
                
            default:
                break;
        }
        
        [_targetCell addSubview: allBtn[i]];
    }
    
    DragonUIButton *ReStartDown = [[DragonUIButton alloc]initWithFrame:CGRectMake(70 + 0*NEWCELL_BTN_HIGHT*1.5, (84 - NEWCELL_BTN_HIGHT)/2, NEWCELL_BTN_HIGHT, NEWCELL_BTN_HIGHT)];
    NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:ReStartDown,@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row",_targetCell,@"cell", nil];
    
    [ReStartDown setBackgroundImage:[UIImage imageNamed:@"删除"] forState:UIControlStateNormal];
    [ReStartDown setBackgroundImage:[UIImage imageNamed:@"删除"] forState:UIControlStateDisabled];

    [ReStartDown addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
    [ReStartDown setHidden:YES];
    [ReStartDown setTag:BTNTAG_RESTART];
    [_targetCell addSubview:ReStartDown];
    RELEASE(ReStartDown);
}


-(void)creatGoodBtn{
    
    for (int i = 0; i < 4; i++) {
        allBtn[i] = [DragonUIButton buttonWithType:UIButtonTypeCustom];

        NSDictionary *dict = [[NSDictionary alloc]initWithObjectsAndKeys:allBtn[i],@"btn",[NSNumber numberWithInt:_touchCellIndexPath.row],@"row", nil];
        [allBtn[i] addSignal:[DYBDataBankSelectBtn TOUCHSIGLEBTN] forControlEvents:UIControlEventTouchUpInside object:dict];
        
        [allBtn[i] setFrame:CGRectMake(50 + i*NEWCELL_BTN_HIGHT*1.5, (84 - NEWCELL_BTN_HIGHT)/2, NEWCELL_BTN_HIGHT, NEWCELL_BTN_HIGHT)];
        
        switch (i) {
            case 0:{
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"转存,移动"] forState:UIControlStateNormal];
                
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@""] forState:UIControlStateDisabled];
                [allBtn[i] setTag:BTNTAG_CHANGE];
            }
                break;
            case 1:
            {
                [allBtn[i] setTag:BTNTAG_GOOD];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"顶"] forState:UIControlStateNormal];
//                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"顶"] forState:UIControlStateDisabled];
                 [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_move_dis"] forState:UIControlStateDisabled];
                
            }
                
                break;
            case 2:
            {
                [allBtn[i] setTag:BTNTAG_BAD];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"踩"] forState:UIControlStateNormal];
//                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"踩"] forState:UIControlStateDisabled];
                 [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"file_move_dis"] forState:UIControlStateDisabled];
                
            }
                
                break;
            case 3:
            {
                [allBtn[i] setTag:BTNTAG_REPORT];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"举报"] forState:UIControlStateNormal];
                [allBtn[i] setBackgroundImage:[UIImage imageNamed:@"举报"] forState:UIControlStateDisabled];
         
            }
                
                break;
           
                
            default:
                break;
        }
        
        [_targetCell addSubview: allBtn[i]];
    }
    
}



@end
